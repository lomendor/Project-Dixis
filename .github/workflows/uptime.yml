name: Uptime smoke
on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:
jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    strategy:
      matrix:
        url:
          - "https://dixis.io/"
          - "https://dixis.io/api/healthz"
          - "https://dixis.io/robots.txt"
          - "https://dixis.io/sitemap.xml"
    steps:
      - name: Curl ${{ matrix.url }}
        run: |
          for i in 1 2 3; do
            code=$(curl -s -o /dev/null -w "%{http_code}" "${{ matrix.url }}") || code=0
            echo "Attempt $i â†’ $code"
            [[ "$code" =~ ^2|3 ]] && exit 0
            sleep 5
          done
          echo "Fail: ${{ matrix.url }}"; exit 1
