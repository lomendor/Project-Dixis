name: Production Smoke

on:
  schedule:
    - cron: '*/15 * * * *' # κάθε 15'
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Healthz (prod)
        run: |
          set -euo pipefail
          URL="https://dixis.gr/api/healthz"
          echo "GET $URL"
          CODE="$(curl -sk --max-time 30 --retry 3 --retry-delay 2 --retry-all-errors -o /tmp/hz.json -w '%{http_code}' "$URL")"
          echo "HTTP $CODE"
          cat /tmp/hz.json || true
          test "$CODE" = "200"
          grep -q '"status":"ok"' /tmp/hz.json

  homepage:
    runs-on: ubuntu-latest
    steps:
      - name: Homepage HEAD
        run: |
          set -euo pipefail
          CODE=$(curl -skI --max-time 30 --retry 3 --retry-delay 2 --retry-all-errors -o /dev/null -w "%{http_code}" https://dixis.gr/)
          echo "HTTP $CODE"
          test "$CODE" = "200"
