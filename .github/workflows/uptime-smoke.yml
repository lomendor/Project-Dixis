name: Uptime Smoke
on:
  schedule: [{cron: "*/10 * * * *"}]
  workflow_dispatch:
jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Probe healthz on prod domain
        run: |
          set -e
          URL="https://dixis.gr/api/healthz"
          echo "Probing $URL"
          RESPONSE=$(curl -fsS --max-time 30 --retry 3 --retry-delay 2 --retry-all-errors "$URL")
          echo "Response: $RESPONSE"
          if echo "$RESPONSE" | grep -qi '"status".*"ok"'; then
            echo "✅ OK: $URL is healthy"
            exit 0
          fi
          echo "❌ Health check failed"; exit 1
