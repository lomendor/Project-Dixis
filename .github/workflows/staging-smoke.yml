name: Staging Smoke

on:
  push:
    branches: [ main ]
    paths:
      - 'frontend/**'
      - '.github/workflows/staging-smoke.yml'
  schedule:
    - cron: '*/30 * * * *' # κάθε 30'
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    # Don't fail CI if staging is down/unavailable (staging environment is optional)
    continue-on-error: true
    steps:
      - name: Healthz
        run: |
          set -euo pipefail
          URL="https://staging.dixis.gr/api/healthz"
          echo "GET $URL"
          CODE="$(curl -sk --max-time 30 --retry 3 --retry-delay 2 --retry-all-errors -o /tmp/hz.json -w '%{http_code}' "$URL")"
          echo "HTTP $CODE"
          cat /tmp/hz.json || true
          test "$CODE" = "200"
          grep -q '"status":"ok"' /tmp/hz.json
