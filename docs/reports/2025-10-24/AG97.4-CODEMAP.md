# AG97.4 â€” CODEMAP

## Modified Files

### .github/workflows/pg-e2e.yml
- **Line 31**: Added `DIXIS_AGG_PROVIDER: pg` to env vars
- **Line 52-54**: Changed from `prisma migrate deploy` to `prisma db push --skip-generate --accept-data-loss`
- **Line 66**: Updated test path to `tests/pg-e2e/orders-facets-aggregation.spec.ts`

## Why These Changes

### prisma db push vs migrate deploy
- **migrate deploy**: Applies migration history (fails when OrderItem relation missing)
- **db push**: Pushes current schema directly (ephemeral DB, no history needed)
- Perfect for CI ephemeral databases

### DIXIS_AGG_PROVIDER=pg
- Enables PG aggregation provider in facets API
- Required for AG97.3 test to validate `provider: 'pg'` response

### Test Path Fix
- Old path: `tests/e2e/api-admin-orders-pg-e2e.spec.ts` (didn't exist)
- New path: `tests/pg-e2e/orders-facets-aggregation.spec.ts` (created in AG97.3)
