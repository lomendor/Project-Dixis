# AG97.2 — RISKS-NEXT

## Risks
- **Minimal**: PG aggregation only active when `DIXIS_AGG_PROVIDER=pg` explicitly set
- **Fallback safety**: Any error in PG path → continues with demo flow
- **Demo override**: `?demo=1` or `?mode=demo` always bypasses PG path
- **Dynamic import**: @prisma/client loaded only when needed (no compile-time errors)
- **Observability**: Response includes `provider: 'pg'` field to verify which path executed

## Testing Strategy
- **Manual**: Set `DIXIS_AGG_PROVIDER=pg` + verify PG aggregation works
- **E2E (AG97.3)**: Add `pg-e2e` label + seed data for automated aggregation tests
- **Performance**: Monitor query times vs. existing pagination loop

## Next Steps
- **AG97.3**:
  - Add `pg-e2e` label to workflow
  - CI seed data for realistic aggregation counts
  - E2E tests verifying facet totals accuracy
  - Performance benchmarks (PG groupBy vs. pagination loop)
- **AG97.4 (optional)**:
  - Shared Prisma client instance (avoid new PrismaClient() per request)
  - Connection pooling optimization
