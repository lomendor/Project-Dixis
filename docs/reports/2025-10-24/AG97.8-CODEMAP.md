# AG97.8 — CODEMAP

## Modified Files

### frontend/playwright.config.ts (lines 85-93)
- **Change**: Added new CI project `api-admin-ci`
- **Reason**: PG E2E test `admin-orders-facets-aggregation.pg-e2e.spec.ts` was not discoverable in CI mode
- **Impact**: Enables Playwright to discover and run admin/API tests in CI environment

**Code Added**:
```typescript
// CI: API/Admin tests (AG97.8 - PG E2E support)
{
  name: 'api-admin-ci',
  use: {
    ...devices['Desktop Chrome']
    // No storageState - API tests use direct requests
  },
  testMatch: ['**/admin-*.spec.ts', '**/api-*.spec.ts']
}
```

## Why This Change

### Root Cause Analysis
1. **CI Mode Projects**: Playwright config had only 2 CI projects:
   - `consumer-ci`: testMatch for smoke, auth-probe, shipping, checkout tests
   - `auth-ui`: testMatch for @no-auth tests
2. **Test Pattern**: PG E2E test named `admin-orders-facets-aggregation.pg-e2e.spec.ts`
3. **Mismatch**: Test pattern `admin-*.spec.ts` didn't match any CI project testMatch
4. **Result**: "No tests found" error even though file existed at correct path

### Solution
- Added third CI project `api-admin-ci` with testMatch: `['**/admin-*.spec.ts', '**/api-*.spec.ts']`
- Covers all admin-prefixed tests (Orders UI tests, PG E2E tests, etc.)
- Covers all api-prefixed tests (API-only E2E tests)
- No storageState needed - these tests use direct API requests or handle their own auth

## Impact
- **Test Discovery**: ✅ PG E2E test now discoverable in CI mode
- **Existing Tests**: ✅ No impact on consumer-ci or auth-ui projects
- **Local Mode**: ✅ No change - producer project already had admin-*.spec.ts pattern
- **Future Tests**: ✅ All admin/API tests automatically included in CI runs
